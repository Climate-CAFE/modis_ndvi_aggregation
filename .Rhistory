library(tigris)
library(terra)
library(tidyverse)
# remotes::install_github("rspatial/luna") #Use this line of code to install
# the luna package for the first time.
library(luna)
# Bring in data for Suffolk County in Massachusetts.
# Shapefiles for USA geometries can be found at:
# https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html
#
ma_county <- counties(year = 2020, geom = T)
# Bring in data for Suffolk County in Massachusetts.
# Shapefiles for USA geometries can be found at:
# https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html
#
ma_county <- counties(year = 2020)
#ma_county <- st_read('./tl_2020_us_county.shp') #Shapefile of all US Counties
ma_county_suff <- ma_county[ma_county$GEOID == "25025", ] #Suffolk County
ma_county_suff <- vect(ma_county_suff)
st_write(ma_county, paste0(datadir, "counties.shp"))
library(sf)
st_write(ma_county, paste0(datadir, "counties.shp"))
library(terra)
library(tidyverse)
library(sf)
# remotes::install_github("rspatial/luna") #Use this line of code to install
# the luna package for the first time.
library(luna)
remotes::install_github("rspatial/luna") #Use this line of code to install
remotes::install_github("rspatial/luna") #Use this line of code to install
remotes::install_github("rspatial/luna") #Use this line of code to install
# the luna package for the first time.
library(luna)
library(tigris)
options(tigris_use_cache = FALSE)
# Read in username and password
#
user <- readLines("/Users/alliej/Desktop/bu/CAFE/CAFE_MODIS/user.txt")
# Ensure password is saved in a secure location
pass <- readLines("/Users/alliej/Desktop/bu/CAFE/CAFE_MODIS/pass.txt")
# Set directory
#
datadir <- "/Users/alliej/Documents/cafe/modis_ndvi_aggregation/example_outputs/" #Fill in with your directory
# https://www.earthdata.nasa.gov/data/catalog/lpcloud-mod13q1-061#toc-file-naming-convention
product_aqua <- "MYD13Q1" # MODIS Aqua. 16-day, 250 m; NDVI/EVI
# Set time frame
#
start <- "2020-07-01"
end <- "2020-07-31"
st_write(ma_county, paste0(datadir, "counties.shp"))
#ma_county <- st_read('./tl_2020_us_county.shp') #Shapefile of all US Counties
ma_county_suff <- ma_county[ma_county$GEOID == "25025", ] #Suffolk County
ma_county_suff <- vect(ma_county_suff)
# Use info to download data from NASA (Aqua)
#
data_ndvi_aqua <- luna::getNASA(product_aqua,
start,
end,
aoi=ext(ma_county_suff),
download=TRUE,
overwrite=TRUE,
path=paste0(datadir, "Suffolk/"),
username=user, #Reference user text file
password=pass) #Reference password text file
# Use info to download data from NASA (Aqua)
#
data_ndvi_aqua <- luna::getNASA(product_aqua,
start,
end,
aoi=ext(ma_county_suff),
download=TRUE,
overwrite=TRUE,
path=paste0(datadir, "Suffolk/"),
username=user, #Reference user text file
password=pass) #Reference password text file
# Bring in raster
#
r_in <- rast(paste0(datadir, "Suffolk/", "MYD13Q1.A2020169.h12v04.061.2020340091454.hdf"))
# Plot it
#
# Disappointing? apply some stretching; see `?plotRGB` for more options
plotRGB(r_in, r = 1, g = 4, b = 3, stretch="lin")
# Plot it
#
# Disappointing? apply some stretching; see `?plotRGB` for more options
plotRGB(r_in, r = 1, g = 4, b = 3, stretch="lin")
View(r_in)
names(r_in)
gdal()
plotRGB(r_in)
class(r_in)
# Load packages
#
library(terra)
# Plot it
#
# Disappointing? apply some stretching; see `?plotRGB` for more options
plotRGB(r_in, r = 1, g = 4, b = 3, stretch="lin")
# Bring in raster
#
r_in <- rast(paste0(datadir, "Suffolk/", "MYD13Q1.A2020169.h12v04.061.2020340091454.hdf"))
# Plot it
#
# Disappointing? apply some stretching; see `?plotRGB` for more options
plotRGB(r_in, r = 1, g = 4, b = 3, stretch="lin")
# Use info to download data from NASA (Aqua)
#
data_ndvi_aqua <- luna::getNASA(product_aqua,
start,
end,
aoi=ext(ma_county_suff),
download=TRUE,
overwrite=TRUE,
path=paste0(datadir, "Suffolk/"),
username=user, #Reference user text file
password=pass) #Reference password text file
?data_ndvi_aqua
?getNASA
# Plot it
#
# Disappointing? apply some stretching; see `?plotRGB` for more options
plotRGB(r_in, r = 1, g = 4, b = 3, stretch="lin")
# Use info to download data from NASA (Aqua)
#
data_ndvi_aqua <- luna::getNASA(product_aqua,
start,
end,
aoi=ext(ma_county_suff),
download=TRUE,
overwrite=TRUE,
path=paste0(datadir, "Suffolk/"),
username=user, #Reference user text file
password=pass) #Reference password text file
install.packages("gdalUtils")
projinfo EPSG:4326
# Plot it
#
# Disappointing? apply some stretching; see `?plotRGB` for more options
plotRGB(r_in, r = 1, g = 4, b = 3, stretch="lin")
# Set directory
#
#datadir <- ".data/" #Fill in with your directory
datadir <- "/Users/alliej/Documents/cafe/modis_ndvi_aggregation/example_outputs/" #Fill in with your directory
# List files (Aqua has much more data)
#
aqua_data_files <- list.files(path = paste0(datadir, "Suffolk/"),
pattern = "MYD13.*.hdf$")
# Data are available in 16 day increments. Summer is most of interest.
# Adjust dates for your time period.
# If you are working with a period of multiple years, that includes a leap year,
# you may need to repeat this process for that year specifically, as summer
# will be a different date range.
#
format(as.Date("2020-06-01"), "%j")
format(as.Date("2020-08-31"), "%j")
aqua_summer_2020 <- aqua_data_files[substr(aqua_data_files, 14, 16) %in% c(153:244)]
# Read in 2018 data
#
data_summer_2020 <- rast(paste0(datadir, "Suffolk/", aqua_summer_2020))
View(data_summer_2020)
plot(data_summer_2020)
# Assess characteristics
#
dim(data_summer_2020)
res(data_summer_2020) #231.6564 231.6564 about 250m
nlyr(data_summer_2020)
names(data_summer_2020) # 3*12 layers = 36
r <- data_summer_2020
from <- c(1,9,11,12,16)
to   <- c(2,9,11,14,16)
reject <- c("01,10,11", "1", "1", "000,011,100,101,110,111", "1")
qa_bits <- cbind(from, to, reject)
qa_bits
# Explore the different layers in the raster (also done above).
# We can see that layers 1 and 2 are the NDVI and EVI values, and
# layer 3 contains the vegetation index "quality" layer.
names(r)
qc <- r[[3]] #Band 3 has the VI Quality layer
plot(qc, main = "Quality")
# This MODIS mask function in the luna package can create a "mask" for each
# layer based on our selection of bad quality pixels. It takes the number of
# bits as an input so we should use the VI Quality layer.
# The other arguments are a raster and a 3-column matrix.
# The first two columns represent the start and end of a range of bits, and the
# third column contains the value(s) that should be rejected.
quality_mask <- modis_mask(qc, 16, qa_bits)
plot(quality_mask, main = "Quality mask")
rmask <- mask(r, quality_mask)
